function createView(a){void 0!==a.loadHandler?console.log(a.loadHandler):a.loadHandler=function(){console.log("dummy handler")};var c={items:[],pages:[],limit:pagination.itemsPerPage,offset:0,currentPage:1,itemsCount:0,itemType:a.itemType,url:a.url,dependencies:a.dependencies},b=new Vue({el:"#"+a.el,data:c,methods:{update:function(a){updateView(this,a)},afterUpdate:function(a){this.$on("iloaded",function(){Vue.nextTick(a)})},afterLoad:function(a){this.$once("iloaded",function(){Vue.nextTick(a)})}}}),
d=new ajaxRequest(c.url,a.el,function(){var a=JSON.parse(d.request.responseText);c.items=a.items;c.itemsCount=a.count;a=pagination.listPages(a.count);c.pages=a;b.$emit("iloaded")});d.sendRequest();return b}
function updateView(a,c){void 0===c&&(c=!0);var b=a.url;0<a.limit&&(b+="&limit="+a.limit);0<a.offset&&(b+="&offset="+a.offset);var d=new ajaxRequest(b,a.$el.id,function(){var b=JSON.parse(d.request.responseText);Vue.set(a,"items",b.items);Vue.set(a,"pages",pagination.listPages(b.count));a.$emit("iloaded");if(1==c&&(b=a.$get("dependencies"),0<b.length))for(var e=0;e<b.length;e++)Vue.set(b[e],"limit",a.limit),Vue.set(b[e],"offset",a.offset),updateView(b[e],!0)});d.sendRequest()}
var pagination={itemsPerPage:10,listPages:function(a){a=Math.ceil(a/this.itemsPerPage);for(var c=[],b=0;b<a;b++){var d=b+1;c.push({index:d,limit:d*this.itemsPerPage})}return c},loadPage:function(a,c){var b=c*this.itemsPerPage-this.itemsPerPage;Vue.set(a,"limit",this.itemsPerPage);Vue.set(a,"offset",b);Vue.set(a,"currentPage",c);a.update(!0)},loadNextPage:function(a){var c=a.$get("currentPage"),b=Math.ceil(a.$get("itemsCount")/this.itemsPerPage),c=c+1;c>b&&(c=b);this.loadPage(a,c)},loadPrevPage:function(a){var c=
a.$get("currentPage")-1;1>c&&(c=1);this.loadPage(a,c)}};
function submitForm(a){var c=a.currentTarget,b=c.action,d=validateCompleteForm(c);a.stopPropagation();a.preventDefault();if(1==d){a="";for(d=0;d<c.elements.length;d++){var f=c.elements[d];if(void 0!=f.attributes.multiple){for(var e="",h=0;h<f.options.length;h++){var k=f.options[h];k.selected&&(e+="&"+f.name+"="+k.value)}""!=e&&(a+=e)}else void 0!=f.value&&(a+="&"+f.name+"="+f.value)}var g=new ajaxRequest(b,"",function(){var a=g.request.responseText;if("ok"==a){formView.update(formView.doUpdate?!0:
!1);systemMessage.added(formView.$get("itemType"));try{formSubmited()}catch(b){}}else console.log(a)});g.requestType="POST";g.postBody=a;g.sendRequest()}}function startWait(a){cssId(a).style.display="block"}function stopWait(a){cssId(a).style.display="none"}closeEndcolor="#377814";deleteEndcolor="#c62424";function confirmDelete(a,c,b,d){1==confirm(a)&&deleteElement(c,b,d)}
function deleteElement(a,c,b){var d=new ajaxRequest(c,"",function(){"ok"==d.request.responseText&&(removeRow(a,deleteEndcolor),void 0!=b&&(b.update(),systemMessage.deleted(b.$get("itemType"))))});d.sendRequest()}function closeElement(a,c,b){var d=new ajaxRequest(c,"",function(){"ok"==d.request.responseText&&(removeRow(a,closeEndcolor),void 0!=b&&(b.update(),systemMessage.closed(b.$get("itemType"))))});d.sendRequest()}
function removeRow(a,c){var b=cssId(a);null!=b&&(b.style.backgroundColor="#FFFFFF",Velocity(b,{backgroundColor:c,backgroundColorAlpha:.6,colorAlpha:.6},{complete:function(){Velocity(b,"fadeOut",{delay:1500,duration:2500})}}))}Vue.filter("truncate",function(a,c){return a.length>=c?a.substr(0,c)+"...":a});
