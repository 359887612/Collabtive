function createView(a){var d={items:[],pages:[],limit:10,offset:0,dependencies:a.dependencies,url:a.url};new Ajax.Request(d.url,{method:"get",onSuccess:function(a){console.log("url "+d.url);a=JSON.parse(a.responseText);d.items=a.items;a=pagination.listPages(a.count);d.pages=a},onLoading:function(){startWait("progress"+a.el)},onComplete:function(){stopWait("progress"+a.el)},onFailure:function(){}});return new Vue({el:"#"+a.el,data:d})}
function updateView(a,d){void 0===d&&(d=!0);var c=a.url;0<a.limit&&(c+="&limit="+a.limit);0<a.offset&&(c+="&offset="+a.offset);new Ajax.Request(c,{method:"get",onSuccess:function(b){b=JSON.parse(b.responseText);a.$set("items",b.items);a.$set("pages",pagination.listPages(b.count));if(1==d&&(b=a.$get("dependencies"),0<b.length))for(var c=0;c<b.length;c++)b[c].$set("limit",a.limit),b[c].$set("offset",a.offset),updateView(b[c],b[c].url)},onLoading:function(){startWait("progress"+a.$el.id)},onComplete:function(){stopWait("progress"+
a.$el.id)},onFailure:function(){}})}var pagination={itemsPerPage:10,listPages:function(a){a=Math.ceil(a/this.itemsPerPage);for(var d=[],c=0;c<a;c++){var b=c+1;d.push({index:b,limit:b*this.itemsPerPage})}return d},loadPage:function(a,d){var c=d*this.itemsPerPage-this.itemsPerPage;a.$set("limit",this.itemsPerPage);a.$set("offset",c);updateView(a,!0)}};
function submitForm(a){var d=a.currentTarget,c=d.action,b=validateCompleteForm(d);console.log("validates:"+b);a.stopPropagation();a.preventDefault();if(1==b){a="";for(i=0;i<d.elements.length;i++)b=d.elements[i],void 0!=b.value&&(a+="&"+b.name+"="+b.value);new Ajax.Request(c,{method:"POST",postBody:a,onSuccess:function(a){200==a.status&&updateView(formView,!1)},onLoading:function(){startWait("progress"+formView.$el)},onComplete:function(){console.log("added");stopWait("progress"+formView.$el)},onFailure:function(){console.log("error")}})}}
function startWait(a){$(a).style.display="block"}function stopWait(a){$(a).style.display="none"};
