function createView(a){var b={items:[],pages:[],limit:10,offset:0,dependencies:a.dependencies,url:a.url};new Ajax.Request(b.url,{method:"get",onSuccess:function(a){console.log("url "+b.url);a=JSON.parse(a.responseText);b.items=a.items;a=pagination.listPages(a.count);b.pages=a},onLoading:function(){startWait("progress"+a.el)},onComplete:function(){stopWait("progress"+a.el)},onFailure:function(){}});return new Vue({el:"#"+a.el,data:b})}
function updateView(a,b){void 0===b&&(b=!0);var d=a.url;0<a.limit&&(d+="&limit="+a.limit);0<a.offset&&(d+="&offset="+a.offset);new Ajax.Request(d,{method:"get",onSuccess:function(c){c=JSON.parse(c.responseText);a.$set("items",c.items);a.$set("pages",pagination.listPages(c.count));if(1==b&&(c=a.$get("dependencies"),0<c.length))for(var d=0;d<c.length;d++)c[d].$set("limit",a.limit),c[d].$set("offset",a.offset),updateView(c[d],c[d].url)},onLoading:function(){startWait("progress"+a.$el.id)},onComplete:function(){stopWait("progress"+
a.$el.id);a.$emit("updated")},onFailure:function(){}})}
var pagination={itemsPerPage:10,listPages:function(a){a=Math.ceil(a/this.itemsPerPage);for(var b=[],d=0;d<a;d++){var c=d+1;b.push({index:c,limit:c*this.itemsPerPage})}return b},loadPage:function(a,b){var d=b*this.itemsPerPage-this.itemsPerPage;a.$set("limit",this.itemsPerPage);a.$set("offset",d);updateView(a,!0)},loadNextPage:function(a){var b;b=1+a.$get("offset")/this.itemsPerPage;b+=1;console.log("next"+b);this.loadPage(a,b)},loadPrevPage:function(a){var b;b=1+a.$get("offset")/this.itemsPerPage;
--b;1>b&&(b=1);console.log("prev"+b);this.loadPage(a,b)}};
function submitForm(a){var b=a.currentTarget,d=b.action,c=validateCompleteForm(b);console.log("validates:"+c);a.stopPropagation();a.preventDefault();if(1==c){a="";for(i=0;i<b.elements.length;i++)c=b.elements[i],void 0!=c.value&&(a+="&"+c.name+"="+c.value);new Ajax.Request(d,{method:"POST",postBody:a,onSuccess:function(a){200==a.status&&updateView(formView,!1)},onLoading:function(){startWait("progress"+formView.$el)},onComplete:function(){console.log("added");stopWait("progress"+formView.$el)},onFailure:function(){console.log("error")}})}}
function startWait(a){$(a).style.display="block"}function stopWait(a){$(a).style.display="none"};
