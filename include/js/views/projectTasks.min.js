var accord_dashboard=new accordion2("blockTasks",{classNames:{toggle:"win_none",toggleActive:"win_block",content:"blockaccordion_content"}});function activateAccordeon(a){accord_dashboard.toggle(document.querySelectorAll("#blockTasks .blockaccordion_content")[a]);setCookie("activeSlideProjectTasks",a)}
window.addEventListener("load",function(){for(var a=document.querySelectorAll("#blockTasks > div[class~='headline'] > a"),c=0;c<a.length;c++){var b=a[c].getAttribute("onclick"),b=b+("activateAccordeon("+c+");");a[c].setAttribute("onclick",b)}activateAccordeon(0)});function taskFormHandler(){this.forms=[];this.views=[]}
taskFormHandler.prototype.bindViews=function(){for(var a=this.forms,c=this.views,b=0;b<a.length;b++)a[b].onsubmit=function(a){var b=a.currentTarget.dataset.index;a.preventDefault();a.stopPropagation();handleForm(a,c[b])}};
var handleForm=function(a,c){var b=a.currentTarget,d=b.action,e=validateCompleteForm(b);a.stopPropagation();a.preventDefault();if(1==e){e="";for(i=0;i<b.elements.length;i++){var g=b.elements[i];void 0!=g.value&&(e+="&"+g.name+"="+g.value)}var f=new ajaxRequest(d,"",function(){if("ok"==f.request.responseText){c.update();systemMessage.added(c.$get("itemType"));var a=b.dataset.tasklist;blindtoggle("form_"+a);toggleClass("add_butn_"+a,"butn_link_active","butn_link");toggleClass("sm_"+a,"smooth","nosmooth")}});
f.requestType="POST";f.postBody=e;f.sendRequest()}};function handleClose(a){a=a.target;closeElement(a.id,"managetask.php?action=close&tid="+a.dataset.task+"id="+a.dataset.project,projectTaskViews[a.dataset.viewindex])}function handleDelete(a){var c=a.target;a=c.dataset.viewindex;var b=c.dataset.task,d=c.dataset.project,c=c.dataset.confirmtext;console.log(c);confirmDelete(c,"task_"+b,"managetask.php?action=del&tid="+b+"id="+d,projectTaskViews[a])}
function initTasklistViews(){var a=new taskFormHandler,c=document.getElementsByClassName("blockaccordion_content");projectTaskViews=[];for(var b=0;b<c.length;b++){var d=createView({el:c[b].id,itemType:"task",url:"managetask.php?action=projectTasks&tlid="+c[b].dataset.tasklist+"&id="+c[b].dataset.project,dependencies:[]});projectTaskViews.push(d);d.afterUpdate(function(){for(var a=document.getElementsByClassName("closeElement"),b=0;b<a.length;b++)a[b].onclick=function(a){handleClose(a)};a=document.getElementsByClassName("deleteElement");
for(b=0;b<a.length;b++)a[b].onclick=function(a){console.log("clicked delete");console.log(a);handleDelete(a)}})}a.forms=document.getElementsByClassName("taskSubmitForm");a.views=projectTaskViews;a.bindViews()}initTasklistViews();
